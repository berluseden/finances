# Integraci√≥n de IA con OpenAI

## üìã Descripci√≥n

Este sistema utiliza **OpenAI GPT-4o** como un asesor financiero inteligente que analiza tus datos y te ayuda a tomar mejores decisiones. No solo extrae datos de PDFs, sino que act√∫a como tu consultor personal.

## ‚ú® Caracter√≠sticas Principales

### 1. ü§ñ Extracci√≥n Autom√°tica de Estados de Cuenta

Sube un PDF y la IA extrae autom√°ticamente:

- **Fechas**: Corte, vencimiento, fecha del statement
- **Saldos**: DOP y USD, cr√©dito disponible, l√≠mites
- **Pagos**: M√≠nimos requeridos en ambas monedas
- **Transacciones**: Total de compras, pagos, intereses
- **Informaci√≥n bancaria**: Banco, n√∫mero de cuenta/tarjeta

### 2. üìä Score de Salud Financiera (0-100)

La IA eval√∫a tu situaci√≥n completa y te da una calificaci√≥n:

- **A (90-100)**: Excelente salud financiera
- **B (80-89)**: Buena salud, peque√±as mejoras
- **C (70-79)**: Salud moderada, necesita atenci√≥n
- **D (60-69)**: Situaci√≥n preocupante
- **F (0-59)**: Situaci√≥n cr√≠tica, acci√≥n urgente

Incluye:
- ‚úÖ **Fortalezas**: Lo que est√°s haciendo bien
- ‚ö†Ô∏è **Debilidades**: √Åreas que necesitan atenci√≥n
- üéØ **Recomendaciones**: Pasos espec√≠ficos para mejorar
- üìù **An√°lisis detallado**: Explicaci√≥n completa de tu situaci√≥n

### 3. üí° Plan de Pagos Inteligente

La IA crea una estrategia personalizada de pagos priorizando:

1. **Urgencia Alta** üî¥: 
   - Vencimientos en 7 d√≠as o menos
   - Uso de cr√©dito >80% (afecta credit score)
   - Cuentas en mora o con penalidades

2. **Prioridad Media** üü°:
   - Tasas de inter√©s altas
   - Uso de cr√©dito 60-80%
   - Deudas que crecen r√°pidamente

3. **Normal** üîµ:
   - Pagos regulares
   - Cuentas con buen comportamiento
   - Mantenimiento general

**Estrategias que usa**:
- **Avalanche**: Ataca primero las tasas m√°s altas
- **Snowball**: Elimina deudas peque√±as para motivaci√≥n
- **Liquidez**: Mantiene cr√©dito disponible para emergencias
- **Moneda**: Aprovecha tasas de cambio favorables

### 4. üö® Alertas Financieras Inteligentes

Monitoreo continuo que genera alertas autom√°ticas:

- **Peligro** üî¥: Problemas urgentes que requieren acci√≥n inmediata
- **Advertencia** üü°: Situaciones a vigilar de cerca
- **Informaci√≥n** üîµ: Tips y recordatorios √∫tiles
- **√âxito** üü¢: Reconocimiento de buenos h√°bitos

Ejemplos:
- "Tu tarjeta X est√° al 95% del l√≠mite - afecta tu credit score"
- "Tienes 3 vencimientos esta semana - total $15,000"
- "¬°Excelente! Pagaste el balance completo este mes"

### 5. üí∞ Identificaci√≥n de Gastos Reducibles

La IA analiza tus patrones y sugiere donde ahorrar:

Para cada categor√≠a de gasto:
- üìä **Gasto actual mensual**: Cu√°nto gastas ahora
- ‚úÇÔ∏è **Reducci√≥n sugerida**: Cu√°nto podr√≠as ahorrar
- üíµ **Ahorro anual**: Impacto a largo plazo
- üí° **Tips espec√≠ficos**: Consejos accionables para reducir

Categor√≠as analizadas:
- Restaurantes y delivery
- Entretenimiento (cines, bares, eventos)
- Suscripciones (Netflix, Spotify, etc.)
- Transporte (Uber, gasolina)
- Supermercado (marcas premium vs econ√≥micas)
- Servicios (telefon√≠a, internet - mejores planes)
- Compras impulsivas

### 6. üîÆ Predicciones de Saldo Futuro

Proyecta tu situaci√≥n financiera 1-3 meses adelante:

- **Estimaciones**: Saldo futuro en DOP y USD
- **Nivel de confianza**: Qu√© tan precisa es la predicci√≥n
- **An√°lisis de tendencias**: Est√°s mejorando o empeorando
- **Factores de riesgo**: Qu√© podr√≠a cambiar la predicci√≥n

Considera:
- Patrones hist√≥ricos de gasto
- Pagos recurrentes confirmados
- Tendencias (crecimiento/reducci√≥n)
- Estacionalidad (ej: diciembre = m√°s gastos)

### 7. üìà Recomendaciones Personalizadas

Basadas en tu perfil espec√≠fico:

- Estrategias de pago √≥ptimas
- Oportunidades de consolidaci√≥n de deudas
- Mejores pr√°cticas adaptadas a RD
- Consejos para mejorar credit score
- Ideas para aumentar ahorros

## üéØ Casos de Uso Reales

### Caso 1: Mar√≠a - M√∫ltiples Tarjetas
**Situaci√≥n**: 4 tarjetas, todas con saldo
**IA sugiere**:
1. Pagar primero Visa (vence en 3 d√≠as)
2. Luego Mastercard (uso 85%, afecta score)
3. American Express puede esperar (solo 40% uso)
4. Consolidar deudas peque√±as en una sola

**Resultado**: Evita mora, mejora score, reduce estr√©s

### Caso 2: Juan - Gastos Elevados
**Situaci√≥n**: Gasta RD$45,000/mes en delivery
**IA identifica**:
- Reducir a RD$30,000 (33% menos)
- Ahorro anual: RD$180,000
- Tips: Cocinar 3 d√≠as/semana, usar cupones

**Resultado**: M√°s de RD$15,000/mes extra para ahorrar

### Caso 3: Ana - Predicci√≥n de Crisis
**Situaci√≥n**: Gastos creciendo 15% mensual
**IA predice**:
- En 2 meses: Llegar√° al l√≠mite de todas las tarjetas
- Riesgo: No poder pagar m√≠nimos
- Acci√≥n: Reducir gastos YA en 25%

**Resultado**: Evita crisis financiera antes de que ocurra

## üöÄ C√≥mo Usar el Sistema

- **Fechas**:
  - Fecha de corte
  - Fecha de vencimiento
  - Fecha del estado de cuenta

- **Saldos**:
  - Saldo de cierre en DOP (Pesos Dominicanos)
  - Saldo de cierre en USD (D√≥lares)
  - Cr√©dito disponible en ambas monedas
  - L√≠mites de cr√©dito

- **Pagos**:
  - Pago m√≠nimo en DOP
  - Pago m√≠nimo en USD

- **Transacciones**:
  - Total de compras
  - Total de pagos
  - Intereses cobrados

- **Informaci√≥n adicional**:
  - Nombre del banco
  - N√∫mero de cuenta/tarjeta (√∫ltimos 4 d√≠gitos)
  - Tasas de inter√©s

### 2. Recomendaciones Financieras

El sistema puede generar recomendaciones personalizadas basadas en:

- Tu comportamiento de gasto
- Uso de cr√©dito disponible
- Patrones de pago
- Acumulaci√≥n de intereses

### 3. An√°lisis de Patrones

Analiza m√∫ltiples estados de cuenta para identificar:

- Tendencias de gasto (¬øest√°s gastando m√°s o menos?)
- Comportamiento de pagos (¬øpagas el m√≠nimo o el total?)
- Uso eficiente del cr√©dito
- Alertas sobre posibles problemas financieros

## üîß Configuraci√≥n

### 1. Obtener API Key de OpenAI

1. Visita https://platform.openai.com/api-keys
2. Crea una cuenta o inicia sesi√≥n
3. Genera una nueva API Key
4. Copia la clave (empieza con `sk-proj-...`)

### 2. Configurar Variables de Entorno

Crea o edita el archivo `.env` en la ra√≠z del proyecto:

```env
VITE_OPENAI_API_KEY=tu-clave-aqui
```

**‚ö†Ô∏è IMPORTANTE**: 
- Nunca compartas tu API Key
- Nunca la subas a GitHub
- El archivo `.env` ya est√° en `.gitignore`

### 3. Costos de OpenAI

El modelo GPT-4o tiene costos por uso:

- **Input**: ~$2.50 por mill√≥n de tokens
- **Output**: ~$10 por mill√≥n de tokens

Un estado de cuenta t√≠pico consume:
- ~5,000 tokens de input (el PDF)
- ~500 tokens de output (los datos extra√≠dos)
- **Costo aproximado**: ~$0.02 USD por estado de cuenta

**Recomendaciones**:
- Configura l√≠mites de gasto en OpenAI Platform
- Monitorea tu uso mensual
- Para producci√≥n, considera mover la API key al backend

## üöÄ Uso

### Subir un Estado de Cuenta

1. Ve a la secci√≥n de **Cuentas**
2. Selecciona la cuenta
3. Haz clic en "Subir Estado de Cuenta"
4. Selecciona el archivo PDF
5. La IA extraer√° autom√°ticamente todos los datos
6. Revisa y confirma los datos extra√≠dos

### Ver Recomendaciones

Las recomendaciones aparecer√°n autom√°ticamente en:

- Dashboard principal
- Detalle de cuenta
- Secci√≥n de presupuestos

## üîç C√≥mo Funciona

### Proceso de Extracci√≥n

```
1. Usuario sube PDF
   ‚Üì
2. Sistema convierte PDF a base64
   ‚Üì
3. Env√≠a a GPT-4o con prompt estructurado
   ‚Üì
4. GPT-4o analiza el documento (visi√≥n)
   ‚Üì
5. Retorna JSON con datos extra√≠dos
   ‚Üì
6. Sistema valida y guarda en Firestore
   ‚Üì
7. Usuario ve los datos autom√°ticamente
```

### Nivel de Confianza

La IA retorna un nivel de confianza para cada extracci√≥n:

- **High** (Alto): Todos los datos encontrados claramente
- **Medium** (Medio): Algunos datos pueden estar faltando
- **Low** (Bajo): Error al procesar, datos incompletos

Solo se guardan autom√°ticamente extracciones con confianza **High** o **Medium**.

## üìù Campos Extra√≠dos

### En Base de Datos (Firestore)

Cada statement incluye:

```typescript
{
  cutDate: Timestamp,
  dueDate: Timestamp,
  closingBalanceDOP: number,
  closingBalanceUSD: number,
  minimumPaymentDOP: number,
  minimumPaymentUSD: number,
  aiExtracted: boolean,        // Si fue extra√≠do por IA
  aiConfidence: 'high' | 'medium' | 'low',
  aiNotes: string,             // Observaciones de la IA
}
```

## üõ†Ô∏è Funciones Disponibles

### `extractStatementData(file: File)`

Extrae datos estructurados de un PDF de estado de cuenta.

```typescript
import { extractStatementData } from '@/lib/openai';

const file = /* File object */;
const data = await extractStatementData(file);

console.log(data);
// {
//   cutDate: "2024-01-15",
//   dueDate: "2024-02-05",
//   closingBalanceDOP: 15000,
//   confidence: "high",
//   ...
// }
```

### `generateFinancialRecommendations(statementData)`

Genera recomendaciones basadas en un estado de cuenta.

```typescript
import { generateFinancialRecommendations } from '@/lib/openai';

const recommendations = await generateFinancialRecommendations(data);

console.log(recommendations);
// [
//   "Considera pagar m√°s del m√≠nimo para reducir intereses",
//   "Tu uso de cr√©dito est√° en 75%, trata de mantenerlo bajo 30%",
//   ...
// ]
```

### `analyzeSpendingPatterns(statements)`

Analiza patrones de m√∫ltiples estados de cuenta.

```typescript
import { analyzeSpendingPatterns } from '@/lib/openai';

const analysis = await analyzeSpendingPatterns([data1, data2, data3]);

console.log(analysis);
// "Tus gastos han incrementado un 15% en los √∫ltimos 3 meses..."
```

## ‚ö†Ô∏è Limitaciones

### Navegador vs Backend

Actualmente la API se llama desde el navegador (`dangerouslyAllowBrowser: true`):

**Ventajas**:
- Implementaci√≥n r√°pida
- No necesita backend

**Desventajas**:
- API Key expuesta en el cliente
- Limitaciones de CORS
- Usuario paga por su uso

**Para Producci√≥n**:
- Mover la l√≥gica a Firebase Functions o backend
- Ocultar la API Key del cliente
- Implementar l√≠mites por usuario

### Precisi√≥n de Extracci√≥n

La precisi√≥n depende de:

- **Calidad del PDF**: PDFs escaneados vs nativos
- **Formato del banco**: Cada banco tiene formatos diferentes
- **Claridad del documento**: Texto legible, no im√°genes borrosas

Si la extracci√≥n falla:
- Verifica que el PDF no est√© protegido
- Aseg√∫rate de que el texto sea seleccionable
- Intenta con otro estado de cuenta

## üîê Seguridad

### Protecci√≥n de API Key

- ‚úÖ Archivo `.env` en `.gitignore`
- ‚úÖ No se sube a repositorios p√∫blicos
- ‚ö†Ô∏è Expuesta en el build del cliente

### Datos Financieros

- Los PDFs se suben a Firebase Storage (privado)
- Los datos extra√≠dos se guardan en Firestore (privado)
- Solo el usuario autenticado puede ver sus datos
- OpenAI **NO** almacena los PDFs enviados (seg√∫n su pol√≠tica)

### Mejores Pr√°cticas

1. **L√≠mites de gasto**: Configura alertas en OpenAI Platform
2. **Rotaci√≥n de keys**: Cambia la API key peri√≥dicamente
3. **Monitoreo**: Revisa el uso mensual de la API
4. **Backend**: En producci√≥n, mueve la API key al servidor

## üêõ Troubleshooting

### Error: "Invalid API Key"

- Verifica que la API Key est√© correcta en `.env`
- Aseg√∫rate de reiniciar el servidor de desarrollo
- Confirma que la key empiece con `sk-proj-`

### Error: "Rate limit exceeded"

- Has excedido el l√≠mite de requests de OpenAI
- Espera unos minutos antes de reintentar
- Verifica tus l√≠mites en OpenAI Platform

### Datos Extra√≠dos Incorrectos

- Revisa el nivel de confianza (`aiConfidence`)
- Verifica las notas de la IA (`aiNotes`)
- Si persiste, reporta el issue con el PDF de ejemplo

### PDF No Se Procesa

- Verifica que el archivo sea realmente un PDF
- Confirma que no est√© protegido con contrase√±a
- Intenta con un PDF m√°s peque√±o (<5 MB)

## üìä Monitoreo

### Revisar Uso de OpenAI

1. Ve a https://platform.openai.com/usage
2. Revisa el consumo diario/mensual
3. Configura alertas de gasto
4. Descarga reportes para an√°lisis

### Logs en Consola

El sistema muestra logs detallados:

```
[OpenAI] Procesando PDF: statement.pdf
[OpenAI] Respuesta recibida: {...}
[OpenAI] ‚úÖ Datos extra√≠dos exitosamente
```

## üöÄ Pr√≥ximas Mejoras

- [ ] Mover API Key al backend (Firebase Functions)
- [ ] Cach√© de extractiones para evitar procesar dos veces
- [ ] Extracci√≥n de transacciones individuales
- [ ] Detecci√≥n autom√°tica de categor√≠as de gasto
- [ ] Dashboard de insights con gr√°ficas
- [ ] Alertas inteligentes (ej: "Gastos inusuales detectados")
- [ ] Exportar an√°lisis a PDF
- [ ] Comparaci√≥n entre meses

## üìö Recursos

- [Documentaci√≥n OpenAI](https://platform.openai.com/docs)
- [GPT-4o Vision](https://platform.openai.com/docs/guides/vision)
- [Pricing OpenAI](https://openai.com/pricing)
- [Best Practices](https://platform.openai.com/docs/guides/production-best-practices)

---

**Desarrollado con ‚ù§Ô∏è usando OpenAI GPT-4o**
